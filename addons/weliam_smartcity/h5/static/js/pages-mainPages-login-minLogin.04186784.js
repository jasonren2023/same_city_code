(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mainPages-login-minLogin"],{1568:function(e,n,a){"use strict";a.r(n);var t=a("a866"),o=a.n(t);for(var i in t)"default"!==i&&function(e){a.d(n,e,(function(){return t[e]}))}(i);n["default"]=o.a},5378:function(e,n,a){var t=a("8e46");"string"===typeof t&&(t=[[e.i,t,""]]),t.locals&&(e.exports=t.locals);var o=a("4f06").default;o("1f50123e",t,!0,{sourceMap:!1,shadowMode:!1})},"5af0":function(e,n,a){"use strict";var t;a.d(n,"b",(function(){return o})),a.d(n,"c",(function(){return i})),a.d(n,"a",(function(){return t}));var o=function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"wechatapp"},[a("v-uni-view",{staticClass:"header"},[a("v-uni-image",{attrs:{src:e.appInfo.logo}}),a("v-uni-view",{staticClass:"app-name t-c f-26 col-3"},[e._v(e._s(e.appInfo.name))])],1)],1),a("v-uni-view",{staticClass:"auth-title"},[e._v("申请获取以下权限:")]),a("v-uni-view",{staticClass:"auth-subtitle"},[e._v("• 获得你的公开信息（昵称、头像等）")]),a("v-uni-view",{staticClass:"dis-flex flex-x-around"},[a("v-uni-button",{staticClass:"login-btn login-cancel",on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.cancelLogin.apply(void 0,arguments)}}},[e._v("暂不登录")]),a("v-uni-button",{staticClass:"login-btn",attrs:{disabled:e.disabled},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.authorLogin.apply(void 0,arguments)}}},[e._v("授权登录")])],1)],1)},i=[]},"645a":function(e,n,a){"use strict";a.r(n);var t=a("5af0"),o=a("1568");for(var i in o)"default"!==i&&function(e){a.d(n,e,(function(){return o[e]}))}(i);a("b3a2");var r,s=a("f0c5"),u=Object(s["a"])(o["default"],t["b"],t["c"],!1,null,"6b326336",null,!1,t["a"],r);n["default"]=u.exports},"8e46":function(e,n,a){var t=a("24fb");n=t(!1),n.push([e.i,"uni-page-body[data-v-6b326336]{background:#fff;font-size:%?32?%}.container[data-v-6b326336]{padding:0 %?60?%}.wechatapp[data-v-6b326336]{padding:15% 0 10%;border-bottom:%?1?% solid #e3e3e3;margin-bottom:%?45?%;text-align:center}.wechatapp .header[data-v-6b326336]{margin:0 auto}.wechatapp .header .app-name[data-v-6b326336]{margin-top:%?30?%}.wechatapp .header uni-image[data-v-6b326336]{width:%?100?%;height:%?100?%;margin:0 auto;display:block;border-radius:50%;border:2px solid #fff;box-shadow:1px 0 5px rgba(50,50,50,.3);background-size:100% 100%}.auth-title[data-v-6b326336]{color:#585858;font-size:%?28?%;margin-bottom:%?40?%}.auth-subtitle[data-v-6b326336]{color:#999;margin-bottom:%?72?%;font-size:%?22?%}.login-btn[data-v-6b326336]{border:none;height:%?80?%;line-height:%?80?%;background:#ffd940;color:#333;font-size:10pt;border-radius:%?6?%;width:45%}.login-btn[data-v-6b326336]::after{display:none}.login-btn.button-hover[data-v-6b326336]{\r\n\t/* box-shadow: inset 0 5upx 30upx rgba(0, 0, 0, 0.15); */}.login-btn.login-cancel[data-v-6b326336]{color:#999;background:#efefef}body.?%PAGE?%[data-v-6b326336]{background:#fff}",""]),e.exports=n},a866:function(e,n,a){"use strict";var t=a("4ea4");a("d3b7"),Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t(a("5530")),i=t(a("77ab")),r={data:function(){return{disabled:!1}},components:{},computed:{appInfo:function(){return this.$store.state.appInfo}},onLoad:function(e){this.authorLogin()},onShow:function(){},mounted:function(){},methods:{pasLogin:function(){uni.reLaunch({url:"/pages/mainPages/login/login"})},appLogin:function(){var e=this,n={};uni.getProvider({service:"oauth",success:function(a){uni.login({provider:"weixin",success:function(a){getCurrentPages();var t=a.authResult.access_token,o=a.authResult.openid;console.log("-------获取openid(unionid)-----"),console.log("token",t),console.log("openid",o),console.log(JSON.stringify(a)),uni.getUserInfo({provider:"weixin",success:function(i){console.log("-------获取微信用户所有-----"),console.log(JSON.stringify(i.userInfo)),n.head_id=uni.getStorageSync("head_id"),n=Object.assign(n,{nickName:i.userInfo.nickName||"",avatarUrl:i.userInfo.avatarUrl,access_token:t,openid:o,source1:"4"}),n=Object.assign(n,a.authResult,i.userInfo),e.getUserInfo(n)}})}})}})},vu:function(){},cancelLogin:function(){uni.navigateBack({delta:2})},authorLogin:function(e){var n=this,a=n.$store.state.clientType;if(n.disabled=!0,"2"===a&&"getUserInfo:ok"!==e.detail.errMsg)return i.default.showError("登录失败,请重试"),n.disabled=!1,!1;n.userLogin("weixin"),uni.getProvider({service:"oauth",success:function(a){console.log("getProvider",a.provider),n.userLogin(a.provider[0],e.detail)}})},getLoginData:function(e,n){return new Promise((function(a,t){n.iv&&n.encryptedData?a(n):uni.getUserInfo({withCredentials:!0,complete:function(n){console.log(n),n.iv||"alipay"===e?(!n.encryptedData&&n.data&&(n.encryptedData=n.data),a(n)):t()}})}))},userLogin:function(e,n){i.default.getClientType();var a={};uni.login({provider:"weixin",scopes:"auth_user",success:function(e){a.code=e.code,a.head_id=uni.getStorageSync("head_id")}})},getUserInfo:function(e){var n=this;console.log("登陆的参数",JSON.stringify(e)),i.default._post_form("&p=member&do=login",(0,o.default)({},e),(function(a){console.log(a),console.log("登陆的参数",e.source);var t=a.data.token;uni.setStorageSync("weliam_user_token",t),n.disabled=!1,n.$store.commit("WXLOGIN",1),n.navigateBack()}),!1,(function(){uni.hideLoading()}))},navigateBack:function(){var e=getCurrentPages(),n=e[e.length-2],a=uni.getStorageSync("currentPage").options;i.default.removeCurrentPage(),"pages/subPages2/drawGame/drawGame"!=n.route?"pages/mainPages/write/write"===n.route?uni.reLaunch({url:"/pages/mainPages/index/index"}):uni.navigateBack():uni.reLaunch({url:"/pages/subPages2/drawGame/drawGame?"+i.default.urlEncode(a)})}}};n.default=r},b3a2:function(e,n,a){"use strict";var t=a("5378"),o=a.n(t);o.a}}]);